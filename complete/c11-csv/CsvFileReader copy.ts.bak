import fs from "fs";
import { dateStringToDate } from "./utils.js";

export type MatchData = [
  Date,
  string,
  string,
  number,
  number,
  MatchResult,
  string
];
export enum MatchResult {
  HomeWin = "H",
  AwayWin = "A",
  Draw = "D",
}

export class CsvFilerReader {
  data: MatchData[] = [];
  constructor(public filename: string) {}

  read(): void {
    const text = fs.readFileSync(this.filename, { encoding: "utf8" });
    this.data = text
      .split("\n")
      .map((line: string) => {
        return line.split(",");
      })
      .map((value: string[], index: number) => {
        let newValue: MatchData = [
          dateStringToDate(value[0]!),
          value[1]!,
          value[2]!,
          parseInt(value[3]!),
          parseInt(value[4]!),
          value[5] as MatchResult, // type assertion
          value[6]!,
        ];

        return newValue;
      });
  }
}
