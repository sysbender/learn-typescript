Working with Custom JSX Specifications in Vite ⚛️
In this lesson, you'll learn how to implement your own custom JSX specification in a Vite project. We'll explore how Vite uses esbuild to transform JSX and how you can configure a custom "factory" function to control the process.

1. Setting Up the Project Structure
First, let's set up the project files. We'll start with a clean slate by clearing out the default main.js and creating a new JSX file.

src/main.js

JavaScript

import './12.css';
import { template } from './12.jsx';

// Select the app element from the HTML
const app = document.querySelector('#app');
// Append the converted JSX content to the app element
app.appendChild(template);
src/12.jsx

JavaScript

// This file will contain our JSX markup
const template = (
  <div class="wrapper">
    <p>
      <a href="#">Link</a>
    </p>
  </div>
);

export { template };
src/12.css
Create a CSS file to style our elements. You can copy existing styles or add your own. Here's a basic example:

CSS

/* Example styles for the wrapper and link */
.wrapper {
  background-color: #2c3e50;
  padding: 20px;
  border-radius: 8px;
}
a {
  color: white;
  text-decoration: none;
}
index.html
Ensure your index.html has a root element with the ID app.

HTML

<body>
  <div id="app"></div>
  <script type="module" src="/src/main.js"></script>
</body>
2. Configuring Vite for JSX
When you first try to run the project, you'll get a console error because Vite doesn't know how to process the JSX syntax by default. We need to configure it to use a custom function to handle the JSX transformation.

vite.config.js
Inside your Vite configuration, we'll specify options for esbuild which Vite uses for bundling. We'll define a jsxFactory option.

JavaScript

import { defineConfig } from 'vite';

export default defineConfig({
  esbuild: {
    jsxFactory: 'create', // <-- This tells esbuild to use a function named 'create'
  },
});
Creating the Custom Factory Function
The jsxFactory option points to a function that will be responsible for creating the DOM elements. This function receives three parameters: element, attributes, and children.

src/12-create.js

JavaScript

function create(element, attributes, ...children) {
  // Create the new DOM node
  const node = document.createElement(element);

  // Set attributes
  if (attributes) {
    for (const [name, value] of Object.entries(attributes)) {
      node.setAttribute(name, value);
    }
  }

  // Append children (if any)
  for (const child of children) {
    if (typeof child === 'string') {
      node.appendChild(document.createTextNode(child));
    } else {
      node.appendChild(child);
    }
  }

  return node;
}

export { create };
Importing the Factory Function
Now, we must import this create function into our JSX file.

src/12.jsx

JavaScript

import { create } from './12-create.js'; // <-- Import the factory function

const template = (
  <div class="wrapper">
    <p>
      <a href="#">Link</a>
    </p>
  </div>
);

export { template };
3. Automating the Import with jsxInject
Having to manually import the create function in every JSX file can be inconvenient. Vite provides a way to automatically inject this import statement for you.

vite.config.js
Add the jsxInject option to the esbuild configuration.

JavaScript

import { defineConfig } from 'vite';

export default defineConfig({
  esbuild: {
    jsxFactory: 'create',
    jsxInject: 'import { create } from "./src/12-create.js"', // <-- Injects this import
  },
});
With this configuration, you can remove the manual import from src/12.jsx, and Vite will handle the rest. Your JSX code will now be properly processed and rendered as a DOM structure on your page.

This process demonstrates how to leverage Vite's esbuild integration to create a completely custom JSX pipeline, giving you full control over how your JSX syntax is transformed.